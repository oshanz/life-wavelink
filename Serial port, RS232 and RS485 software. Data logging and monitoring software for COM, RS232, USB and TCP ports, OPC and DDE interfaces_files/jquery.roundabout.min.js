(function(c){var r,s,f;c.extend({roundaboutShapes:{def:"lazySusan",lazySusan:function(a,b,c){return{x:Math.sin(a+b),y:Math.sin(a+3*Math.PI/2+b)/8*c,z:(Math.cos(a+b)+1)/2,scale:Math.sin(a+Math.PI/2+b)/2+.5}}}});r={bearing:0,tilt:0,minZ:100,maxZ:280,minOpacity:.4,maxOpacity:1,minScale:.4,maxScale:1,duration:600,btnNext:null,btnNextCallback:function(){},btnPrev:null,btnPrevCallback:function(){},btnToggleAutoplay:null,btnStartAutoplay:null,btnStopAutoplay:null,easing:"swing",clickToFocus:!0,clickToFocusCallback:function(){},
focusBearing:0,shape:"lazySusan",debug:!1,childSelector:"li",startingChild:null,reflect:!1,floatComparisonThreshold:.001,autoplay:!1,autoplayDuration:1E3,autoplayPauseOnHover:!1,autoplayCallback:function(){},autoplayInitialDelay:0,enableDrag:!1,dropDuration:600,dropEasing:"swing",dropAnimateTo:"nearest",dropCallback:function(){},dragAxis:"x",dragFactor:4,triggerFocusEvents:!0,triggerBlurEvents:!0,responsive:!1};s={autoplayInterval:null,autoplayIsRunning:!1,autoplayStartTimeout:null,animating:!1,childInFocus:-1,
touchMoveStartPosition:null,stopAnimation:!1,lastAnimationStep:!1};f={init:function(a,b,g){var d;(new Date).getTime();a="object"===typeof a?a:{};b=c.isFunction(b)?b:function(){};b=c.isFunction(a)?a:b;d=c.extend({},r,a,s);return this.each(function(){var a=c(this),k=a.children(d.childSelector).length,h=360/k,k=d.startingChild&&d.startingChild>k-1?k-1:d.startingChild,m=null===d.startingChild?d.bearing:360-k*h,n="static"!==a.css("position")?a.css("position"):"relative";a.css({padding:0,position:n}).addClass("roundabout-holder").data("roundabout",
c.extend({},d,{startingChild:k,bearing:m,oppositeOfFocusBearing:f.normalize.apply(null,[d.focusBearing-180]),dragBearing:m,period:h}));g?a.unbind(".roundabout").children(d.childSelector).unbind(".roundabout"):d.responsive&&c(window).bind("resize",function(){f.stopAutoplay.apply(a);f.relayoutChildren.apply(a)});d.clickToFocus&&a.children(d.childSelector).each(function(b){c(this).bind("click.roundabout",function(){var d=f.getPlacement.apply(a,[b]);if(!f.isInFocus.apply(a,[d]))return f.stopAnimation.apply(c(this)),
a.data("roundabout").animating||f.animateBearingToFocus.apply(a,[d,a.data("roundabout").clickToFocusCallback]),!1})});d.btnNext&&c(d.btnNext).bind("click.roundabout",function(){a.data("roundabout").animating||f.animateToNextChild.apply(a,[a.data("roundabout").btnNextCallback]);return!1});d.btnPrev&&c(d.btnPrev).bind("click.roundabout",function(){f.animateToPreviousChild.apply(a,[a.data("roundabout").btnPrevCallback]);return!1});d.btnToggleAutoplay&&c(d.btnToggleAutoplay).bind("click.roundabout",function(){f.toggleAutoplay.apply(a);
return!1});d.btnStartAutoplay&&c(d.btnStartAutoplay).bind("click.roundabout",function(){f.startAutoplay.apply(a);return!1});d.btnStopAutoplay&&c(d.btnStopAutoplay).bind("click.roundabout",function(){f.stopAutoplay.apply(a);return!1});d.autoplayPauseOnHover&&a.bind("mouseenter.roundabout.autoplay",function(){f.stopAutoplay.apply(a,[!0])}).bind("mouseleave.roundabout.autoplay",function(){f.startAutoplay.apply(a)});d.enableDrag&&(c.isFunction(a.drag)?c.isFunction(a.drop)?a.drag(function(b,c){var d=a.data("roundabout"),
g="x"===d.dragAxis.toLowerCase()?"deltaX":"deltaY";f.stopAnimation.apply(a);f.setBearing.apply(a,[d.dragBearing+c[g]/d.dragFactor])}).drop(function(b){b=a.data("roundabout");var c=f.getAnimateToMethod(b.dropAnimateTo);f.allowAnimation.apply(a);f[c].apply(a,[b.dropDuration,b.dropEasing,b.dropCallback]);b.dragBearing=b.period*f.getNearestChild.apply(a)}):d.debug&&alert("You do not have the drop plugin loaded."):d.debug&&alert("You do not have the drag plugin loaded."),a.each(function(){var a=c(this).get(0),
b=c(this).data("roundabout"),d="x"===b.dragAxis.toLowerCase()?"pageX":"pageY",g=f.getAnimateToMethod(b.dropAnimateTo);a.addEventListener&&(a.addEventListener("touchstart",function(a){b.touchMoveStartPosition=a.touches[0][d]},!1),a.addEventListener("touchmove",function(a){var g=(a.touches[0][d]-b.touchMoveStartPosition)/b.dragFactor;a.preventDefault();f.stopAnimation.apply(c(this));f.setBearing.apply(c(this),[b.dragBearing+g])},!1),a.addEventListener("touchend",function(a){a.preventDefault();f.allowAnimation.apply(c(this));
g=f.getAnimateToMethod(b.dropAnimateTo);f[g].apply(c(this),[b.dropDuration,b.dropEasing,b.dropCallback]);b.dragBearing=b.period*f.getNearestChild.apply(c(this))},!1))}));f.initChildren.apply(a,[b,g])})},initChildren:function(a,b){var g=c(this),d=g.data("roundabout");a=a||function(){};g.children(d.childSelector).each(function(a){var d,h,m,n=f.getPlacement.apply(g,[a]);b&&c(this).data("roundabout")&&(d=c(this).data("roundabout").startWidth,h=c(this).data("roundabout").startHeight,m=c(this).data("roundabout").startFontSize);
c(this).addClass("roundabout-moveable-item").css("position","absolute");c(this).data("roundabout",{startWidth:d||c(this).width(),startHeight:h||c(this).height(),startFontSize:m||parseInt(c(this).css("font-size"),10),degrees:n,backDegrees:f.normalize.apply(null,[n-180]),childNumber:a,currentScale:1,parent:g})});f.updateChildren.apply(g);d.autoplay&&(d.autoplayStartTimeout=setTimeout(function(){f.startAutoplay.apply(g)},d.autoplayInitialDelay));g.trigger("ready");a.apply(g);return g},updateChildren:function(){return this.each(function(){var a=
.9,b=c(this).data("roundabout");if(b.fixedItemWidth){var g=c(this).width()-b.fixedItemWidth;0>g&&(a=(c(this).width()+g)/b.fixedItemWidth);.9<a&&(a=.9)}var a=Math.floor(c(this).width()*a),d=c(this),b=d.data("roundabout"),e=-1,k={bearing:b.bearing,tilt:b.tilt,stage:{width:a,height:Math.floor(.9*c(this).height())},animating:b.animating,inFocus:b.childInFocus,focusBearingRadian:f.degToRad.apply(null,[b.focusBearing]),shape:c.roundaboutShapes[b.shape]||c.roundaboutShapes[c.roundaboutShapes.def]};k.midStage=
{width:k.stage.width/2,height:k.stage.height/2};k.nudge={width:k.midStage.width+.05*k.stage.width,height:k.midStage.height+.05*k.stage.height};k.zValues={min:b.minZ,max:b.maxZ,diff:b.maxZ-b.minZ};k.opacity={min:b.minOpacity,max:b.maxOpacity,diff:b.maxOpacity-b.minOpacity};k.scale={min:b.minScale,max:b.maxScale,diff:b.maxScale-b.minScale};d.children(b.childSelector).each(function(a){!f.updateChild.apply(d,[c(this),k,a,function(){c(this).trigger("ready")}])||k.animating&&!b.lastAnimationStep?c(this).removeClass("roundabout-in-focus"):
(e=a,c(this).addClass("roundabout-in-focus"))});e!==k.inFocus&&(b.triggerBlurEvents&&d.children(b.childSelector).eq(k.inFocus).trigger("blur"),b.childInFocus=e,b.triggerFocusEvents&&-1!==e&&d.children(b.childSelector).eq(e).trigger("focus"));d.trigger("childrenUpdated")})},updateChild:function(a,b,g,d){var e;a=c(a);var k=a.data("roundabout"),h=[];e=f.degToRad.apply(null,[360-k.degrees+b.bearing]);d=d||function(){};e=f.normalizeRad.apply(null,[e]);e=b.shape(e,b.focusBearingRadian,b.tilt);e.scale=1<
e.scale?1:e.scale;e.adjustedScale=(b.scale.min+b.scale.diff*e.scale).toFixed(4);e.width=(e.adjustedScale*k.startWidth).toFixed(4);e.height=(e.adjustedScale*k.startHeight).toFixed(4);a.css({left:(e.x*b.midStage.width+b.nudge.width-e.width/2).toFixed(0)+"px",top:(e.y*b.midStage.height+b.nudge.height-e.height/2).toFixed(0)+"px",width:e.width+"px",height:e.height+"px",opacity:(b.opacity.min+b.opacity.diff*e.scale).toFixed(2),zIndex:Math.round(b.zValues.min+b.zValues.diff*e.z),fontSize:(e.adjustedScale*
k.startFontSize).toFixed(1)+"px"});k.currentScale=e.adjustedScale;this.data("roundabout").debug&&(h.push('<div style="font-weight: normal; font-size: 10px; padding: 2px; width: '+a.css("width")+'; background-color: #ffc;">'),h.push('<strong style="font-size: 12px; white-space: nowrap;">Child '+g+"</strong><br />"),h.push("<strong>left:</strong> "+a.css("left")+"<br />"),h.push("<strong>top:</strong> "+a.css("top")+"<br />"),h.push("<strong>width:</strong> "+a.css("width")+"<br />"),h.push("<strong>opacity:</strong> "+
a.css("opacity")+"<br />"),h.push("<strong>height:</strong> "+a.css("height")+"<br />"),h.push("<strong>z-index:</strong> "+a.css("z-index")+"<br />"),h.push("<strong>font-size:</strong> "+a.css("font-size")+"<br />"),h.push("<strong>scale:</strong> "+a.data("roundabout").currentScale),h.push("</div>"),a.html(h.join("")));a.trigger("reposition");d.apply(this);return f.isInFocus.apply(this,[k.degrees])},setBearing:function(a,b){b=b||function(){};a=f.normalize.apply(null,[a]);this.each(function(){var b,
d=c(this),e=d.data("roundabout"),k=e.bearing;e.bearing=a;d.trigger("bearingSet");f.updateChildren.apply(d);b=Math.abs(k-a);!e.animating||180<b||(b=Math.abs(k-a),d.children(e.childSelector).each(function(b){f.isChildBackDegreesBetween.apply(c(this),[a,k])&&(b=k>a?"Clockwise":"Counterclockwise",c(this).trigger("move"+b+"ThroughBack"))}))});b.apply(this);return this},adjustBearing:function(a,b){b=b||function(){};if(0===a)return this;this.each(function(){f.setBearing.apply(c(this),[c(this).data("roundabout").bearing+
a])});b.apply(this);return this},setTilt:function(a,b){b=b||function(){};this.each(function(){c(this).data("roundabout").tilt=a;f.updateChildren.apply(c(this))});b.apply(this);return this},adjustTilt:function(a,b){b=b||function(){};this.each(function(){f.setTilt.apply(c(this),[c(this).data("roundabout").tilt+a])});b.apply(this);return this},animateToBearing:function(a,b,g,d,e){var k=(new Date).getTime();e=e||function(){};c.isFunction(d)?(e=d,d=null):c.isFunction(g)?(e=g,g=null):c.isFunction(b)&&(e=
b,b=null);this.each(function(){var h,m,n=c(this),l=n.data("roundabout"),p=b?b:l.duration,q=g?g:l.easing||"swing";d||(d={timerStart:k,start:l.bearing,totalTime:p});h=k-d.timerStart;l.stopAnimation?(f.allowAnimation.apply(n),l.animating=!1):h<p?(l.animating||n.trigger("animationStart"),l.animating=!0,"string"===typeof c.easing.def?(m=c.easing[q]||c.easing[c.easing.def],h=m(null,h,d.start,a-d.start,d.totalTime)):h=c.easing[q](h/d.totalTime,h,d.start,a-d.start,d.totalTime),0<=f.compareVersions.apply(null,
[c().jquery,"1.7.2"])&&!c.easing.easeOutBack&&(h=d.start+(a-d.start)*h),h=f.normalize.apply(null,[h]),l.dragBearing=h,f.setBearing.apply(n,[h,function(){setTimeout(function(){f.animateToBearing.apply(n,[a,p,q,d,e])},0)}])):(l.lastAnimationStep=!0,a=f.normalize.apply(null,[a]),f.setBearing.apply(n,[a,function(){n.trigger("animationEnd")}]),l.animating=!1,l.lastAnimationStep=!1,l.dragBearing=a,e.apply(n))});return this},animateToNearbyChild:function(a,b){var g=a[0],d=a[1],e=a[2]||function(){};c.isFunction(d)?
(e=d,d=null):c.isFunction(g)&&(e=g,g=null);return this.each(function(){var a,h,m,n=c(this),l=n.data("roundabout"),p=l.reflect?l.bearing:l.bearing%360,q=n.children(l.childSelector).length;if(!l.animating)if(l.reflect&&"previous"===b||!l.reflect&&"next"===b)for(p=Math.abs(p)<l.floatComparisonThreshold?360:p,m=0;m<q;m+=1){if(a=l.period*m,h=l.period*(m+1),h=m===q-1?360:h,p<=Math.ceil(h)&&p>=Math.floor(a)){2===q&&360===p?f.animateToDelta.apply(n,[-180,g,d,e]):f.animateBearingToFocus.apply(n,[a,g,d,e]);
break}}else for(p=Math.abs(p)<l.floatComparisonThreshold||360-Math.abs(p)<l.floatComparisonThreshold?0:p,m=q-1;0<=m;m-=1)if(a=l.period*m,h=l.period*(m+1),h=m===q-1?360:h,p>=Math.floor(a)&&p<Math.ceil(h)){2===q&&360===p?f.animateToDelta.apply(n,[180,g,d,e]):f.animateBearingToFocus.apply(n,[h,g,d,e]);break}})},animateToNearestChild:function(a,b,g){g=g||function(){};c.isFunction(b)?(g=b,b=null):c.isFunction(a)&&(g=a,a=null);return this.each(function(){var d=f.getNearestChild.apply(c(this));f.animateToChild.apply(c(this),
[d,a,b,g])})},animateToChild:function(a,b,g,d){d=d||function(){};c.isFunction(g)?(d=g,g=null):c.isFunction(b)&&(d=b,b=null);return this.each(function(){var e,k=c(this);e=k.data("roundabout");e.childInFocus===a||e.animating||(e=k.children(e.childSelector).eq(a),f.animateBearingToFocus.apply(k,[e.data("roundabout").degrees,b,g,d]))})},animateToNextChild:function(a,b,c){return f.animateToNearbyChild.apply(this,[arguments,"next"])},animateToPreviousChild:function(a,b,c){return f.animateToNearbyChild.apply(this,
[arguments,"previous"])},animateToDelta:function(a,b,g,d){d=d||function(){};c.isFunction(g)?(d=g,g=null):c.isFunction(b)&&(d=b,b=null);return this.each(function(){var e=c(this).data("roundabout").bearing+a;f.animateToBearing.apply(c(this),[e,b,g,d])})},animateBearingToFocus:function(a,b,g,d){d=d||function(){};c.isFunction(g)?(d=g,g=null):c.isFunction(b)&&(d=b,b=null);return this.each(function(){var e=c(this).data("roundabout").bearing-a,e=Math.abs(360-e)<Math.abs(e)?360-e:-e,e=180<e?-(360-e):e;0!==
e&&f.animateToDelta.apply(c(this),[e,b,g,d])})},stopAnimation:function(){return this.each(function(){c(this).data("roundabout").stopAnimation=!0})},allowAnimation:function(){return this.each(function(){c(this).data("roundabout").stopAnimation=!1})},startAutoplay:function(a){return this.each(function(){var b=c(this),g=b.data("roundabout");a=a||g.autoplayCallback||function(){};clearInterval(g.autoplayInterval);g.autoplayInterval=setInterval(function(){f.animateToNextChild.apply(b,[a])},g.autoplayDuration);
g.autoplayIsRunning=!0;b.trigger("autoplayStart")})},stopAutoplay:function(a){return this.each(function(){clearInterval(c(this).data("roundabout").autoplayInterval);c(this).data("roundabout").autoplayInterval=null;c(this).data("roundabout").autoplayIsRunning=!1;a||c(this).unbind(".autoplay");c(this).trigger("autoplayStop")})},toggleAutoplay:function(a){return this.each(function(){var b=c(this).data("roundabout");a=a||b.autoplayCallback||function(){};f.isAutoplaying.apply(c(this))?f.stopAutoplay.apply(c(this),
[a]):f.startAutoplay.apply(c(this),[a])})},isAutoplaying:function(){return this.data("roundabout").autoplayIsRunning},changeAutoplayDuration:function(a){return this.each(function(){var b=c(this);b.data("roundabout").autoplayDuration=a;f.isAutoplaying.apply(b)&&(f.stopAutoplay.apply(b),setTimeout(function(){f.startAutoplay.apply(b)},10))})},normalize:function(a){a%=360;return 0>a?360+a:a},normalizeRad:function(a){for(;0>a;)a+=2*Math.PI;for(;a>2*Math.PI;)a-=2*Math.PI;return a},isChildBackDegreesBetween:function(a,
b){var g=c(this).data("roundabout").backDegrees;return a>b?g>=b&&g<a:g<b&&g>=a},getAnimateToMethod:function(a){a=a.toLowerCase();return"next"===a?"animateToNextChild":"previous"===a?"animateToPreviousChild":"animateToNearestChild"},relayoutChildren:function(){return this.each(function(){var a=c(this),b=c.extend({},a.data("roundabout"));b.startingChild=a.data("roundabout").childInFocus;f.init.apply(a,[b,null,!0])})},getNearestChild:function(){var a=c(this),b=a.data("roundabout"),a=a.children(b.childSelector).length;
return b.reflect?Math.round(b.bearing/b.period)%a:(a-Math.round(b.bearing/b.period)%a)%a},degToRad:function(a){return f.normalize.apply(null,[a])*Math.PI/180},getPlacement:function(a){var b=this.data("roundabout");return b.reflect?b.period*a:360-b.period*a},isInFocus:function(a){var b=this.data("roundabout"),c=f.normalize.apply(null,[b.bearing]);a=f.normalize.apply(null,[a]);a=Math.abs(c-a);return a<=b.floatComparisonThreshold||a>=360-b.floatComparisonThreshold},getChildInFocus:function(){var a=c(this).data("roundabout");
return-1<a.childInFocus?a.childInFocus:!1},compareVersions:function(a,b){var c,d=a.split(/\./i),e=b.split(/\./i),f=d.length>e.length?d.length:e.length;for(c=0;c<=f;c++){if(d[c]&&!e[c]&&0!==parseInt(d[c],10))return 1;if(e[c]&&!d[c]&&0!==parseInt(e[c],10))return-1;if(d[c]!==e[c]&&d[c]&&e[c])return parseInt(d[c],10)>parseInt(e[c],10)?1:-1}return 0}};c.fn.roundabout=function(a){if(f[a])return f[a].apply(this,Array.prototype.slice.call(arguments,1));if("object"===typeof a||c.isFunction(a)||!a)return f.init.apply(this,
arguments);c.error("Method "+a+" does not exist for jQuery.roundabout.")}})(jQuery);
