<!DOCTYPE html>
<!-- saved from url=(0074)http://blog.codinghorror.com/so-youd-like-to-send-some-email-through-code/ -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<title>So You'd Like to Send Some Email (Through Code)</title>
<meta name="description" content="">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="shortcut icon" href="http://blog.codinghorror.com/assets/images/favicon.ico?v=205ada7bc2">
<link rel="apple-touch-icon" href="./So You'd Like to Send Some Email (Through Code)_files/codinghorror-app-icon.png">
<meta name="google-site-verification" content="sl0m9SU_4V0JcvjWlOX4dUFBR6VS2P4tlxjJMo0gphU">
<link rel="stylesheet" type="text/css" href="./So You'd Like to Send Some Email (Through Code)_files/screen.css">
<link rel="stylesheet" type="text/css" href="./So You'd Like to Send Some Email (Through Code)_files/css">
<link rel="alternate" type="application/rss+xml" title="Coding Horror" href="http://feeds.feedburner.com/codinghorror">
<style>div[style="margin-bottom:10px"],
.welovecodinghorror,
#hireme
{display:none !important;}</style><div class="fit-vids-style" id="fit-vids-style" style="display: none;">Â­<style>.fluid-width-video-wrapper{width:100%;position:relative;padding:0;}.fluid-width-video-wrapper iframe,.fluid-width-video-wrapper object,.fluid-width-video-wrapper embed {position:absolute;top:0;left:0;width:100%;height:100%;}</style></div><script async="" src="http://www.google.com/adsense/search/async-ads.js"></script><script src="./So You'd Like to Send Some Email (Through Code)_files/p" async="" type="text/javascript"></script><script type="text/javascript" async="" src="http://engine.carbonads.com/z/56742/azcarbon_2_1_0_VERT"></script><script type="text/javascript" async="" src="./So You'd Like to Send Some Email (Through Code)_files/embed.js"></script><link type="text/css" rel="stylesheet" href="./So You'd Like to Send Some Email (Through Code)_files/jobs.min.css"><script src="./So You'd Like to Send Some Email (Through Code)_files/jsapi" type="text/javascript"></script><script type="text/javascript" src="./So You'd Like to Send Some Email (Through Code)_files/saved_resource"></script><script type="text/javascript" src="https://www.google.com/uds/?file=ads&v=3&packages=search&async=2"></script><link type="text/css" href="./So You'd Like to Send Some Email (Through Code)_files/default+en.css" rel="stylesheet"><link type="text/css" href="./So You'd Like to Send Some Email (Through Code)_files/default.css" rel="stylesheet"><script type="text/javascript" src="./So You'd Like to Send Some Email (Through Code)_files/default+en.I.js"></script><style type="text/css">
.gsc-control-cse {
font-family: Arial, sans-serif;
border-color: #FFFFFF;
background-color: #FFFFFF;
}
.gsc-control-cse .gsc-table-result {
font-family: Arial, sans-serif;
}
input.gsc-input, .gsc-input-box, .gsc-input-box-hover, .gsc-input-box-focus {
border-color: #D9D9D9;
}
input.gsc-search-button, input.gsc-search-button:hover, input.gsc-search-button:focus {
border-color: #666666;
background-color: #CECECE;
background-image: none;
filter: none;
}
.gsc-tabHeader.gsc-tabhInactive {
border-color: #E9E9E9;
background-color: #E9E9E9;
}
.gsc-tabHeader.gsc-tabhActive {
border-color: #FF9900;
border-bottom-color: #FFFFFF;
background-color: #FFFFFF;
}
.gsc-tabsArea {
border-color: #FF9900;
}
.gsc-webResult.gsc-result,
.gsc-results .gsc-imageResult {
border-color: #FFFFFF;
background-color: #FFFFFF;
}
.gsc-webResult.gsc-result:hover,
.gsc-imageResult:hover {
border-color: #FFFFFF;
background-color: #FFFFFF;
}
.gs-webResult.gs-result a.gs-title:link,
.gs-webResult.gs-result a.gs-title:link b,
.gs-imageResult a.gs-title:link,
.gs-imageResult a.gs-title:link b {
color: #0000CC;
}
.gs-webResult.gs-result a.gs-title:visited,
.gs-webResult.gs-result a.gs-title:visited b,
.gs-imageResult a.gs-title:visited,
.gs-imageResult a.gs-title:visited b {
color: #0000CC;
}
.gs-webResult.gs-result a.gs-title:hover,
.gs-webResult.gs-result a.gs-title:hover b,
.gs-imageResult a.gs-title:hover,
.gs-imageResult a.gs-title:hover b {
color: #0000CC;
}
.gs-webResult.gs-result a.gs-title:active,
.gs-webResult.gs-result a.gs-title:active b,
.gs-imageResult a.gs-title:active,
.gs-imageResult a.gs-title:active b {
color: #0000CC;
}
.gsc-cursor-page {
color: #0000CC;
}
a.gsc-trailing-more-results:link {
color: #0000CC;
}
.gs-webResult .gs-snippet,
.gs-imageResult .gs-snippet,
.gs-fileFormatType {
color: #000000;
}
.gs-webResult div.gs-visibleUrl,
.gs-imageResult div.gs-visibleUrl {
color: #008000;
}
.gs-webResult div.gs-visibleUrl-short {
color: #008000;
}
.gs-webResult div.gs-visibleUrl-short {
display: none;
}
.gs-webResult div.gs-visibleUrl-long {
display: block;
}
.gs-promotion div.gs-visibleUrl-short {
display: none;
}
.gs-promotion div.gs-visibleUrl-long {
display: block;
}
.gsc-cursor-box {
border-color: #FFFFFF;
}
.gsc-results .gsc-cursor-box .gsc-cursor-page {
border-color: #E9E9E9;
background-color: #FFFFFF;
color: #0000CC;
}
.gsc-results .gsc-cursor-box .gsc-cursor-current-page {
border-color: #FF9900;
background-color: #FFFFFF;
color: #0000CC;
}
.gsc-webResult.gsc-result.gsc-promotion {
border-color: #336699;
background-color: #FFFFFF;
}
.gsc-completion-title {
color: #0000CC;
}
.gsc-completion-snippet {
color: #000000;
}
.gs-promotion a.gs-title:link,
.gs-promotion a.gs-title:link *,
.gs-promotion .gs-snippet a:link {
color: #0000CC;
}
.gs-promotion a.gs-title:visited,
.gs-promotion a.gs-title:visited *,
.gs-promotion .gs-snippet a:visited {
color: #0000CC;
}
.gs-promotion a.gs-title:hover,
.gs-promotion a.gs-title:hover *,
.gs-promotion .gs-snippet a:hover {
color: #0000CC;
}
.gs-promotion a.gs-title:active,
.gs-promotion a.gs-title:active *,
.gs-promotion .gs-snippet a:active {
color: #0000CC;
}
.gs-promotion .gs-snippet,
.gs-promotion .gs-title .gs-promotion-title-right,
.gs-promotion .gs-title .gs-promotion-title-right * {
color: #000000;
}
.gs-promotion .gs-visibleUrl,
.gs-promotion .gs-visibleUrl-short {
color: #008000;
}
</style><style type="text/css">.gscb_a{display:inline-block;font:27px/13px arial,sans-serif}.gsst_a .gscb_a{color:#a1b9ed;cursor:pointer}.gsst_a:hover .gscb_a,.gsst_a:focus .gscb_a{color:#36c}.gsst_a{display:inline-block}.gsst_a{cursor:pointer;padding:0 4px}.gsst_a:hover{text-decoration:none!important}.gsst_b{font-size:16px;padding:0 2px;position:relative;user-select:none;-webkit-user-select:none;white-space:nowrap}.gsst_e{opacity:0.55;}.gsst_a:hover .gsst_e,.gsst_a:focus .gsst_e{opacity:0.72;}.gsst_a:active .gsst_e{opacity:1;}.gsst_f{background:white;text-align:left}.gsst_g{background-color:white;border:1px solid #ccc;border-top-color:#d9d9d9;box-shadow:0 2px 4px rgba(0,0,0,0.2);-webkit-box-shadow:0 2px 4px rgba(0,0,0,0.2);margin:-1px -3px;padding:0 6px}.gsst_h{background-color:white;height:1px;margin-bottom:-1px;position:relative;top:-1px}.gsib_a{width:100%;padding:4px 6px 0}.gsib_a,.gsib_b{vertical-align:top}.gssb_c{border:0;position:absolute;z-index:989}.gssb_e{border:1px solid #ccc;border-top-color:#d9d9d9;box-shadow:0 2px 4px rgba(0,0,0,0.2);-webkit-box-shadow:0 2px 4px rgba(0,0,0,0.2);cursor:default}.gssb_f{visibility:hidden;white-space:nowrap}.gssb_k{border:0;display:block;position:absolute;top:0;z-index:988}.gsdd_a{border:none!important}.gsq_a{padding:0}.gscsep_a{display:none}.gssb_a{padding:0 7px}.gssb_a,.gssb_a td{white-space:nowrap;overflow:hidden;line-height:22px}#gssb_b{font-size:11px;color:#36c;text-decoration:none}#gssb_b:hover{font-size:11px;color:#36c;text-decoration:underline}.gssb_g{text-align:center;padding:8px 0 7px;position:relative}.gssb_h{font-size:15px;height:28px;margin:0.2em;-webkit-appearance:button}.gssb_i{background:#eee}.gss_ifl{visibility:hidden;padding-left:5px}.gssb_i .gss_ifl{visibility:visible}a.gssb_j{font-size:13px;color:#36c;text-decoration:none;line-height:100%}a.gssb_j:hover{text-decoration:underline}.gssb_l{height:1px;background-color:#e5e5e5}.gssb_m{color:#000;background:#fff}.gsfe_a{border:1px solid #b9b9b9;border-top-color:#a0a0a0;box-shadow:inset 0px 1px 2px rgba(0,0,0,0.1);-moz-box-shadow:inset 0px 1px 2px rgba(0,0,0,0.1);-webkit-box-shadow:inset 0px 1px 2px rgba(0,0,0,0.1);}.gsfe_b{border:1px solid #4d90fe;outline:none;box-shadow:inset 0px 1px 2px rgba(0,0,0,0.3);-moz-box-shadow:inset 0px 1px 2px rgba(0,0,0,0.3);-webkit-box-shadow:inset 0px 1px 2px rgba(0,0,0,0.3);}.gssb_a{padding:0 9px}.gsib_a{padding-right:8px;padding-left:8px}.gsst_a{padding-top:3px}.gssb_e{border:0}.gssb_l{margin:5px 0}.gssb_c .gsc-completion-container{position:static}.gssb_c{z-index:5000}.gsc-completion-container table{background:transparent;font-size:inherit;font-family:inherit}.gssb_c > tbody > tr,.gssb_c > tbody > tr > td,.gssb_d,.gssb_d > tbody > tr,.gssb_d > tbody > tr > td,.gssb_e,.gssb_e > tbody > tr,.gssb_e > tbody > tr > td{padding:0;margin:0;border:0}.gssb_a table,.gssb_a table tr,.gssb_a table tr td{padding:0;margin:0;border:0}</style></head>
<body class="post-template">
<header class="site-head">
<div class="site-head-content">
<a class="blog-logo" href="http://blog.codinghorror.com/"><img src="./So You'd Like to Send Some Email (Through Code)_files/codinghorror-app-icon.png" alt="Coding Horror Logo" width="158" height="158"></a>
<h1 class="blog-title"><a href="http://blog.codinghorror.com/">Coding Horror</a></h1>
<h2 class="blog-description">programming and human factors</h2>
<div class="site-search">
<script type="text/javascript" async="" src="./So You'd Like to Send Some Email (Through Code)_files/cse.js"></script><script>
                  (function() {
                    var cx = '016956275695630057531:lqveu9tah7y';
                    var gcse = document.createElement('script');
                    gcse.type = 'text/javascript';
                    gcse.async = true;
                    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//www.google.com/cse/cse.js?cx=' + cx;
                    var s = document.getElementsByTagName('script')[0];
                    s.parentNode.insertBefore(gcse, s);
                  })();
                </script>
<div id="___gcse_0"><div class="gsc-control-cse gsc-control-cse-en"><div class="gsc-control-wrapper-cse" dir="ltr"><form class="gsc-search-box gsc-search-box-tools" accept-charset="utf-8"><table cellspacing="0" cellpadding="0" class="gsc-search-box"><tbody><tr><td class="gsc-input"><div class="gsc-input-box" id="gsc-iw-id1"><table cellspacing="0" cellpadding="0" id="gs_id50" class="gstl_50 " style="width: 100%; padding: 0px;"><tbody><tr><td id="gs_tti50" class="gsib_a"><input autocomplete="off" type="text" size="10" class="gsc-input" name="search" title="search" id="gsc-i-id1" dir="ltr" spellcheck="false" style="width: 100%; padding: 0px; border: none; margin: 0px; height: auto; outline: none; background: url(http://www.google.com/cse/intl/en/images/google_custom_search_watermark.gif) 0% 50% no-repeat rgb(255, 255, 255);"></td><td class="gsib_b"><div class="gsst_b" id="gs_st50" dir="ltr"><a class="gsst_a" href="javascript:void(0)" style="display: none;"><span class="gscb_a" id="gs_cb50">Ã</span></a></div></td></tr></tbody></table></div><input type="hidden" name="bgresponse" id="bgresponse"></td><td class="gsc-search-button"><input type="image" src="./So You'd Like to Send Some Email (Through Code)_files/search_box_icon.png" class="gsc-search-button gsc-search-button-v2" title="search"></td><td class="gsc-clear-button"><div class="gsc-clear-button" title="clear results">&nbsp;</div></td></tr></tbody></table><table cellspacing="0" cellpadding="0" class="gsc-branding"><tbody><tr><td class="gsc-branding-user-defined"></td><td class="gsc-branding-text"><div class="gsc-branding-text">powered by</div></td><td class="gsc-branding-img"><img src="./So You'd Like to Send Some Email (Through Code)_files/small-logo.png" class="gsc-branding-img"></td></tr></tbody></table></form><div class="gsc-results-wrapper-overlay"><div class="gsc-results-close-btn" tabindex="0"></div><div class="gsc-tabsAreaInvisible"><div class="gsc-tabHeader gsc-inline-block gsc-tabhActive">Custom Search</div><span class="gs-spacer"> </span></div><div class="gsc-tabsAreaInvisible"></div><div class="gsc-above-wrapper-area-invisible"><table cellspacing="0" cellpadding="0" class="gsc-above-wrapper-area-container"><tbody><tr><td class="gsc-result-info-container"><div class="gsc-result-info-invisible"></div></td><td class="gsc-orderby-container"><div class="gsc-orderby-invisible"><div class="gsc-orderby-label gsc-inline-block">Sort by:</div><div class="gsc-option-menu-container gsc-inline-block"><div class="gsc-selected-option-container gsc-inline-block"><div class="gsc-selected-option">Relevance</div><div class="gsc-option-selector"></div></div><div class="gsc-option-menu-invisible"><div class="gsc-option-menu-item gsc-option-menu-item-highlighted"><div class="gsc-option">Relevance</div></div><div class="gsc-option-menu-item"><div class="gsc-option">Date</div></div></div></div></div></td></tr></tbody></table></div><div class="gsc-adBlockInvisible"></div><div class="gsc-wrapper"><div class="gsc-adBlockInvisible"></div><div class="gsc-resultsbox-invisible"><div class="gsc-resultsRoot gsc-tabData gsc-tabdActive"><table cellspacing="0" cellpadding="0" class="gsc-resultsHeader"><tbody><tr><td class="gsc-twiddleRegionCell"><div class="gsc-twiddle"><div class="gsc-title">Web</div></div><div class="gsc-stats"></div><div class="gsc-results-selector gsc-all-results-active"><div class="gsc-result-selector gsc-one-result" title="show one result">&nbsp;</div><div class="gsc-result-selector gsc-more-results" title="show more results">&nbsp;</div><div class="gsc-result-selector gsc-all-results" title="show all results">&nbsp;</div></div></td><td class="gsc-configLabelCell"></td></tr></tbody></table><div><div class="gsc-expansionArea"></div></div></div></div></div></div><div class="gsc-modal-background-image" tabindex="0"></div></div></div></div>
</div>
</div>
</header>
<div class="wrap clearfix">
<div class="clearfix"></div>
<main class="content" role="main">
<article class="post">
<span class="post-meta"><time datetime="2010-04-21">21 Apr 2010</time> </span>
<h1 class="post-title">So You'd Like to Send Some Email (Through Code)</h1>
<section class="post-content">
<p>I have what I would charitably describe as a <a href="http://www.google.com/search?q=site:codinghorror.com+email">hate-hate</a> relationship with email. I desperately try to avoid sending email, not just for myself, but also in the code I write.</p>
<p>Despite my misgivings, <b>email is the cockroach of communication mediums: <i>you just can't kill it</i></b>. Email is the one method of online contact that almost everyone -- at least for that subset of "everyone" which includes people who can bear to touch a computer at all -- is guaranteed to have, and use. Yes, you can make a fairly compelling case that email is <a href="http://www.techdirt.com/articles/20071114/144228.shtml">for old stupid people</a>, but let's table that discussion for now.</p>
<p>So, reluctantly, we come to the issue of <b>sending email through code</b>. It's easy! Let's send some email through oh, I don't know, let's say ... Ruby, courtesy of some sample code I found while <a href="http://stackoverflow.com/questions/tagged/ruby">browsing the Ruby tag</a> on Stack Overflow.</p>
<pre>require 'net/smtp'
def send_email(to, subject = "", body = "")
from = "my@email.com<script cf-hash="f9e31" type="text/javascript">
/* <![CDATA[ */!function(){try{var t="currentScript"in document?document.currentScript:function(){for(var t=document.getElementsByTagName("script"),e=t.length;e--;)if(t[e].getAttribute("cf-hash"))return t[e]}();if(t&&t.previousSibling){var e,r,n,i,c=t.previousSibling,a=c.getAttribute("data-cfemail");if(a){for(e="",r=parseInt(a.substr(0,2),16),n=2;a.length-n;n+=2)i=parseInt(a.substr(n,2),16)^r,e+=String.fromCharCode(i);e=document.createTextNode(e),c.parentNode.replaceChild(e,c)}}}catch(u){}}();/* ]]> */</script>"
body= "From: #{from}rnTo: #{to}rnSubject: #{subject}rnrn#{body}rn"
Net::SMTP.start('192.168.10.213', 25, '192.168.0.218') do |smtp|
smtp.send_message body, from, to
end
end
send_email "foo@example.com<script cf-hash="f9e31" type="text/javascript">
/* <![CDATA[ */!function(){try{var t="currentScript"in document?document.currentScript:function(){for(var t=document.getElementsByTagName("script"),e=t.length;e--;)if(t[e].getAttribute("cf-hash"))return t[e]}();if(t&&t.previousSibling){var e,r,n,i,c=t.previousSibling,a=c.getAttribute("data-cfemail");if(a){for(e="",r=parseInt(a.substr(0,2),16),n=2;a.length-n;n+=2)i=parseInt(a.substr(n,2),16)^r,e+=String.fromCharCode(i);e=document.createTextNode(e),c.parentNode.replaceChild(e,c)}}}catch(u){}}();/* ]]> */</script>", "title", "body goes here"
</pre>
<p>There's a bug in this code, though. Do you see it?</p>
<p><b>Just because you <i>send</i> an email doesn't mean it will arrive.</b> Not by a long shot. Bear in mind this is <i>email</i> we're talking about. It was never designed to survive a bitter onslaught of criminals and spam, not to mention the explosive, exponential growth it has seen over the last twenty years. Email is a well that has been truly and thoroughly poisoned -- the digital equivalent of a superfund cleanup site. The ecosystem around email is a dank miasma of half-implemented, incompletely supported anti-spam hacks and workarounds.</p>
<p>Which means the odds of that random email your code just sent getting to its specific destination is .. spotty. At best.</p>
<p>If you want email your code sends to actually <i>arrive</i> in someone's AOL mailbox, to <a href="http://www.fastcompany.com/magazine/18/voice.html">the dulcet tones of "You've Got Mail!"</a>, there are a few things you must do first. And most of them are only peripherally related to writing code.</p>
<p><b>1. Make sure the computer sending the email has a Reverse PTR record</b></p>
<p>What's a <a href="http://aplawrence.com/Blog/B961.html">reverse PTR record</a>? It's something your ISP has to configure for you -- a way of verifying that the email you send from a particular IP address actually belongs to the domain it is purportedly from.</p>
<blockquote>
Not every IP address has a corresponding PTR record. In fact, if you took a random sampling of addresses your firewall blocked because they were up to no good, you'd probably find most have no PTR record - a dig -x gets you no information. That's also apt to be true for mail spammers, or their PTR doesn't match up: if you do a dig -x on their IP you get a result, but if you look up that result you might not get the same IP you started with.
That's why PTR records have become important. Originally, PTR records were just intended as a convenience, and perhaps as a way to be neat and complete. There still are no requirements that you have a PTR record or that it be accurate, but because of the abuse of the internet by spammers, certain conventions have grown up. For example, you may not be able to send email to some sites if you don't have a valid PTR record, or if your pointer is "generic".
How do you get a PTR record? You might think that this is done by your domain registrar - after all, they point your domain to an IP address. Or you might think whoever handles your DNS would do this. But the PTR record isn't up to them, it's up to the ISP that "owns" the IP block it came from. They are the ones who need to create the PTR record.
</blockquote>
<p>A reverse PTR record is critical. How critical? <font color="red">Don't even bother reading any further until you've verified that your ISP has correctly configured the reverse PTR record for the server that will be sending email</font>. It is absolutely the most common check done by mail servers these days. Fail the reverse PTR check, and I guarantee that a <i>huge</i> percentage of the emails you send will end up in the great bit bucket in the sky -- and not in the email inboxes you intended.</p>
<p><b>2. Configure DomainKeys Identified Mail in your DNS and code</b></p>
<p>What's <a href="http://en.wikipedia.org/wiki/DKIM">DomainKeys Identified Mail</a>? With DKIM, you "sign" every email you send with your private key, a key only <i>you</i> could possibly know. And this can be verified by attempting to decrypt the email using the public key stored in your public DNS records. It's really quite clever!</p>
<p>The first thing you need to do is generate some public-private key pairs (one for every domain you want to send email from) via OpenSSL. I used <a href="http://www.slproweb.com/products/Win32OpenSSL.html">a win32 version I found</a>. Issue these commands to produce the keys in the below files:</p>
<pre><code>$ openssl genrsa -out rsa.private 1024
$ openssl rsa -in rsa.private -out rsa.public -pubout -outform PEM
</code></pre>
<p>These public and private keys are just big ol' Base64 encoded strings, so plop them in your code as configuration string resources that you can retrieve later.</p>
<p>Next, add some DNS records. You'll need two new TXT records.</p>
<ol>
<li><font color="red">_domainkey</font>.example.com<br>
"o=~; r=contact@example.com<script cf-hash="f9e31" type="text/javascript">
/* <![CDATA[ */!function(){try{var t="currentScript"in document?document.currentScript:function(){for(var t=document.getElementsByTagName("script"),e=t.length;e--;)if(t[e].getAttribute("cf-hash"))return t[e]}();if(t&&t.previousSibling){var e,r,n,i,c=t.previousSibling,a=c.getAttribute("data-cfemail");if(a){for(e="",r=parseInt(a.substr(0,2),16),n=2;a.length-n;n+=2)i=parseInt(a.substr(n,2),16)^r,e+=String.fromCharCode(i);e=document.createTextNode(e),c.parentNode.replaceChild(e,c)}}}catch(u){}}();/* ]]> */</script>"
</li><li><font color="red">selector._domainkey</font>.example.com<br>
"k=rsa; p={public-key-base64-string-here}"
</li></ol>
<p>The first TXT DNS record is the global DomainKeys policy and contact email.</p>
<p>The second TXT DNS record is the public base64 key you generated earlier, as one giant unbroken string. Note that the "selector" part of this record can be anything you want; it's basically just a disambiguating string.</p>
<p>Almost done. One last thing -- we need to sign our emails before sending them. In any rational world this would be handled by an email library of some kind. We use <a href="http://www.afterlogic.com/products/net-email-components">Mailbee.NET</a> which makes this fairly painless:</p>
<pre>smtp.Message = dk.Sign(smtp.Message,
null, <font color="red">AppSettings.Email.DomainKeyPrivate</font>, false, "selector");
</pre>
<p><b>3. Set up a SPF / SenderID record in your DNS</b></p>
<p>To be honest, <a href="http://en.wikipedia.org/wiki/Sender_ID">SenderID</a> is a bit of a "nice to have" compared to the above two. But if you've gone this far, you might as well go the distance. SenderID, while a little antiquated and kind of.. Microsoft/Hotmail centric.. doesn't take much additional effort.</p>
<p>SenderID isn't complicated. It's another TXT DNS record at the root of, say, example.com, which contains a specially formatted string documenting all the allowed IP addresses that mail can be expected to come from. Here's an example:</p>
<pre>"v=spf1 a mx ip4:10.0.0.1 ip4:10.0.0.2 ~all"
</pre>
<p>You can use the <a href="http://www.microsoft.com/mscorp/safety/content/technologies/senderid/wizard/">Sender ID SPF Record Wizard</a> to generate one of these for each domain you send email from.</p>
<p><b>That sucked. How do I know all this junk is working?</b></p>
<p>I agree, it sucked. Email sucks; what did you expect? I used two methods to verify that all the above was working:</p>
<ol>
<li>Test emails sent to a GMail account.<br><br>
Use the "show original" menu on the arriving email to see the raw message content as seen by the email server. You want to verify that the headers definitely contain the following:
<pre>Received-SPF: pass
Authentication-Results: ... spf=pass ... dkim=pass</pre>
If you see that, then the Reverse PTR and DKIM signing you set up is working. Google provides <i>excellent</i> diagnostic feedback in their email server headers, so if something isn't working, you can usually discover enough of a hint there to figure out why.<br><br>
</li><li>Test emails sent to the Port25 email verifier<br><br>
Port25 offers a really nifty public service -- you can send email to check-auth@verifier.port25.com<script cf-hash="f9e31" type="text/javascript">
/* <![CDATA[ */!function(){try{var t="currentScript"in document?document.currentScript:function(){for(var t=document.getElementsByTagName("script"),e=t.length;e--;)if(t[e].getAttribute("cf-hash"))return t[e]}();if(t&&t.previousSibling){var e,r,n,i,c=t.previousSibling,a=c.getAttribute("data-cfemail");if(a){for(e="",r=parseInt(a.substr(0,2),16),n=2;a.length-n;n+=2)i=parseInt(a.substr(n,2),16)^r,e+=String.fromCharCode(i);e=document.createTextNode(e),c.parentNode.replaceChild(e,c)}}}catch(u){}}();/* ]]> */</script> and it will reply to the from: address with an extensive diagnostic! Here's an example summary result from a test email I just sent to it:
<pre>SPF check:          pass
DomainKeys check:   fail
DKIM check:         pass
Sender-ID check:    pass
SpamAssassin check: ham
</pre>
You want to pass SPF, DKIM, and Sender-ID. Don't worry about the DomainKeys failure, as I believe it is spurious -- DKIM is the "newer" version of that same protocol.
</li></ol>
<p>Yes, the above three steps are quite a bit of work just to send a lousy email. But I don't send email lightly. By the time I've reached the point where I am forced to write code to send out email, <b>I really, <i>really</i> want those damn emails to arrive</b>. By any means necessary.</p>
<p>And for those who are the unfortunate recipients of these emails: my condolences.</p>
</section>
<footer class="post-footer">
<section class="author">
<h4>Written by Jeff Atwood</h4>
<p>Indoor enthusiast. Co-founder of Stack Exchange and Discourse. Disclaimer: I have no idea what I'm talking about. Find me here: <a href="http://twitter.com/codinghorror">http://twitter.com/codinghorror</a></p>
</section>
</footer>
</article>
<div id="discourse-comments"><iframe src="./So You'd Like to Send Some Email (Through Code)_files/comments.html" id="discourse-embed-frame" width="100%" frameborder="0" scrolling="no" height="14730px"></iframe></div>
<script type="text/javascript">
      var discourseUrl = "http://discourse.codinghorror.com/",
          discourseEmbedUrl = 'http://blog.codinghorror.com/so-youd-like-to-send-some-email-through-code/';

      (function() {
        var d = document.createElement('script'); d.type = 'text/javascript'; d.async = true;
          d.src = discourseUrl + 'javascripts/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(d);
      })();
    </script>
</main>
<aside class="sidebar">
 
<div id="carbonads-container"><div class="carbonad"><div id="azcarbon"></div><script type="text/javascript">var z = document.createElement("script"); z.type = "text/javascript"; z.async = true; z.src = "http://engine.carbonads.com/z/56742/azcarbon_2_1_0_VERT"; var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(z, s);</script></div></div>
<div id="hireme" class="hireme codinghorror tagged" style="min-height: 220px; margin-bottom: 15px;"><a href="http://careers.stackoverflow.com/jobs?a=DS5G" target="_blank" data-la="DS5G" data-hf="h" class="top"></a><ul class="jobs"><li><a data-cid="156929" data-la="nDgZrr0KkOB" href="http://careers.stackoverflow.com/jobs/70470/software-engineer-to-solve-hard-problems-with-big-abide-financial-ltd" target="_blank" title="Software Engineer to solve hard problems with big data at Abide Financial Ltd. Click to learn more.">Software Engineer to solve hard problems with big data<br><div class="company">Abide Financial</div><div class="location" title="Bristol, UK">Bristol, UK</div></a></li><li><a data-cid="108203" data-la="6VOgX5zF0Fc" href="http://careers.stackoverflow.com/jobs/20671/python-django-developer-pilotlight-studios" target="_blank" title="Python/Django Developer at pilotLight Studios. Click to learn more.">Python/Django Developer<br><div class="company">pilotLight Studios</div><div class="location" title="Philadelphia, PA; Moorestown, NJ / remote">Philadelphia,&nbsp;PA;&nbsp;Moorestoâ¦ / remote</div><span class="post-tag">django</span><span class="post-tag">python</span></a></li></ul><img class="impression" src="./So You'd Like to Send Some Email (Through Code)_files/i" style="display:none;"><img class="impression" src="./So You'd Like to Send Some Email (Through Code)_files/nDgZrr0KkOB-6VOgX5zF0Fc-DS5G" style="display:none;"></div>
<script>
        setTimeout(function () {
            var a = document.createElement("script");
            var b = document.getElementsByTagName('script')[0];
            a.src = "//clc.stackoverflow.com/j/p?d=hireme";
            a.async = true; 
            a.type = "text/javascript"; 
            b.parentNode.insertBefore(a, b);
        }, 5);
    </script>
<div class="welovecodinghorror" style="margin-bottom:15px">
[ad] Enjoy the blog? Read <b><a href="http://www.hyperink.com/Effective-Programming-More-Than-Writing-Code-b1559">Effective Programming: More than Writing Code</a></b> and <b><a href="http://www.hyperink.com/How-To-Stop-Sucking-And-Be-Awesome-Instead-b9A74B5CBA6">How to Stop Sucking and Be Awesome Instead</a></b> on your Kindle, iPad, Nook, or as a PDF.
</div>
<h3>Resources</h3>
<ul>
<li><a href="http://blog.codinghorror.com/about-me/">About Me</a></li>
<li><a href="http://twitter.com/codinghorror">@codinghorror</a></li>
<li><a href="http://www.discourse.org/">discourse.org</a></li>
<li><a href="http://stackexchange.com/">stackexchange.com</a></li>
<li><a href="http://blog.codinghorror.com/recommended-reading-for-developers/">Recommended Reading</a></li>
</ul>
<ul>
<li><a href="http://feeds.feedburner.com/codinghorror" class="icon-feed">&nbsp;Subscribe in a reader</a></li>
<li><a href="http://feedburner.google.com/fb/a/mailverify?uri=codinghorror&loc=en_US" class="icon-email">&nbsp;Subscribe via email</a></li>
</ul>
<p>Coding Horror has been continuously published since 2004</p>
<ul>
<li><img src="./So You'd Like to Send Some Email (Through Code)_files/codinghorror" height="26" width="88" style="border:0" alt="Count of RSS readers"></li>
<li><a href="http://my.statcounter.com/project/standard/stats.php?project_id=2600027&guest=1">Traffic Stats</a></li>
</ul>
<footer class="site-footer">
<section class="copyright">Copyright <a rel="author" href="https://profiles.google.com/codinghorror1">Jeff Atwood</a> Â© 2015<br>
Logo image Â© 1993 Steven C. McConnell <br>
Proudly published with <a class="icon-ghost" href="http://ghost.org/">Ghost</a></section>
</footer></aside>
</div>
<script src="./So You'd Like to Send Some Email (Through Code)_files/jquery.min.js"></script>
<script type="text/javascript" src="./So You'd Like to Send Some Email (Through Code)_files/jquery.fitvids.js"></script>
<script type="text/javascript" src="./So You'd Like to Send Some Email (Through Code)_files/index.js"></script>
<script async="" src="http://www.statcounter.com/counter/counter.js"></script>
<noscript>&lt;a href="http://www.statcounter.com/"&gt;&lt;img src="http://c26.statcounter.com/counter.php?sc_project=2600027&amp;amp;java=0&amp;amp;security=dcff5548&amp;amp;invisible=0" alt="web metrics"&gt;&lt;/a&gt; </noscript>
 
<script>
    document.write(unescape("%3Cscript src='" + (document.location.protocol == "https:" ? "https://sb" : "http://b") + ".scorecardresearch.com/beacon.js'%3E%3C/script%3E"));
    </script><script src="http://b.scorecardresearch.com/beacon.js"></script>
<script>
    COMSCORE.beacon({
      c1: 2,
      c2: "6035669",
      c3: "",
      c4: "http://www.codinghorror.com/blog/",
      c5: "",
      c6: "",
      c15: ""
    });
    </script>
<noscript>
&lt;img src="http://b.scorecardresearch.com/b?c1=2&amp;amp;c2=6035669&amp;amp;c3=&amp;amp;c4=http%3A%2F%2Fwww.codinghorror.com%2Fblog%2F&amp;amp;c5=&amp;amp;c6=&amp;amp;c15=&amp;amp;cv=1.3&amp;amp;cj=1" style="display:none" width="0" height="0" alt=""/&gt;
</noscript>
<img src="./So You'd Like to Send Some Email (Through Code)_files/view.gif" alt="" style="display:none" hidden="">


<style>#carbonads-container,.carbonad,[href^="http://www.google.com/aclk?"]
{display:none !important;}</style><table cellspacing="0" cellpadding="0" class="gstl_50 gssb_c" style="width: 217px; display: none; top: 72px; position: absolute; left: 876px;"><tbody><tr><td class="gssb_f"></td><td class="gssb_e" style="width: 100%;"></td></tr></tbody></table></body></html>